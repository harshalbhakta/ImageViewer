/*
    ImageViewer v 1.1.3
    Author: Sudhanshu Yadav
    Copyright (c) 2015 to Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo on: http://ignitersworld.com/lab/imageViewer.html
*/

!function(a,b,c,d){"use strict";function k(a,b,c,d){return a/=d,a--,-c*(a*a*a*a-1)+b}function l(a){return a.complete&&("undefined"==typeof a.naturalWidth||0!==a.naturalWidth)}function n(a,b){this.container=a,this.onStart=b.onStart||e,this.onMove=b.onMove||e,this.onEnd=b.onEnd||e,this.sliderId=b.sliderId||"slider"+Math.ceil(1e6*Math.random())}function o(b,c){var d=this;b.is("#iv-container")&&(d._fullPage=!0),d.container=b,c=d.options=a.extend({},o.defaults,c),d.zoomValue=100,b.find(".snap-view").length||b.prepend(m),b.addClass("iv-container"),"static"==b.css("position")&&b.css("position","relative"),d.snapView=b.find(".iv-snap-view"),d.snapImageWrap=b.find(".iv-snap-image-wrap"),d.imageWrap=b.find(".iv-image-wrap"),d.snapHandle=b.find(".iv-snap-handle"),d.zoomHandle=b.find(".iv-zoom-handle"),d._viewerId="iv"+Math.floor(1e6*Math.random())}var e=function(){},f=a("body"),g=a(b),h=a(c),i=15,j=5;!function(){for(var a=0,c=["ms","moz","webkit","o"],d=0;d<c.length&&!b.requestAnimationFrame;++d)b.requestAnimationFrame=b[c[d]+"RequestAnimationFrame"],b.cancelAnimationFrame=b[c[d]+"CancelAnimationFrame"]||b[c[d]+"CancelRequestAnimationFrame"];b.requestAnimationFrame||(b.requestAnimationFrame=function(c,d){var e=(new Date).getTime(),f=Math.max(0,16-(e-a)),g=b.setTimeout(function(){c(e+f)},f);return a=e+f,g}),b.cancelAnimationFrame||(b.cancelAnimationFrame=function(a){clearTimeout(a)})}();var m='<div class="iv-loader"></div> <div class="iv-snap-view"><div class="iv-snap-image-wrap"><div class="iv-snap-handle"></div></div><div class="iv-zoom-slider"><div class="iv-zoom-handle"></div></div></div><div class="iv-image-view" ><div class="iv-image-wrap" ></div></div>';a(function(){f.length||(f=a("body")),f.append('<div id="iv-container">'+m+'<div class="iv-close"></div><div>')}),n.prototype.init=function(){var a=this,c=(this.container,"."+this.sliderId);return this.container.on("touchstart"+c+" mousedown"+c,function(b){b.preventDefault();var d=("touchstart"==b.type?"touchmove":"mousemove")+c,e=("touchstart"==b.type?"touchend":"mouseup")+c,f=b.originalEvent,g=f.clientX||f.touches[0].clientX,i=f.clientY||f.touches[0].clientY,j=a.onStart(b,{x:g,y:i});if(j!==!1){var k=function(b){b.preventDefault(),f=b.originalEvent;var c=f.clientX||f.touches[0].clientX,d=f.clientY||f.touches[0].clientY;a.onMove(b,{dx:c-g,dy:d-i,mx:c,my:d})},l=function(){h.off(d,k),h.off(e,l),a.onEnd()};h.on(d,k),h.on(e,l)}}),this},o.prototype={constructor:o,_init:function(){function x(c){b.snapView&&(w||a.zoomValue<=100||!a.loaded||(clearTimeout(v),w=!0,a.snapView.css("opacity",1),c||(v=setTimeout(function(){a.snapView.css("opacity",0),w=!1},4e3))))}var a=this,b=a.options,c=!1,d=this.container,e="."+a._viewerId,f=this.snapHandle,l=this.snapImageWrap,m=this.imageWrap,o=new n(l,{sliderId:a._viewerId,onStart:function(){if(!a.loaded)return!1;var b=f[0].style;this.curHandleTop=parseFloat(b.top),this.curHandleLeft=parseFloat(b.left),this.handleWidth=parseFloat(b.width),this.handleHeight=parseFloat(b.height),this.width=l.width(),this.height=l.height(),clearInterval(p.slideMomentumCheck),cancelAnimationFrame(p.sliderMomentumFrame)},onMove:function(b,c){var d=this.curHandleLeft+100*c.dx/this.width,e=this.curHandleTop+100*c.dy/this.height;d=Math.max(0,d),d=Math.min(100-this.handleWidth,d),e=Math.max(0,e),e=Math.min(100-this.handleHeight,e);var g=a.containerDim,h=a.imageDim.w*(a.zoomValue/100),i=a.imageDim.h*(a.zoomValue/100),j=h<g.w?(g.w-h)/2:-h*d/100,k=i<g.h?(g.h-i)/2:-i*e/100;f.css({top:e+"%",left:d+"%"}),a.currentImg.css({left:j,top:k})}}).init(),p=a._imageSlider=new n(m,{sliderId:a._viewerId,onStart:function(b,d){if(!a.loaded)return!1;if(!c){var e=this;o.onStart(),e.imgWidth=a.imageDim.w*a.zoomValue/100,e.imgHeight=a.imageDim.h*a.zoomValue/100,e.positions=[d,d],e.startPosition=d,a._clearFrames(),e.slideMomentumCheck=setInterval(function(){e.currentPos&&(e.positions.shift(),e.positions.push({x:e.currentPos.mx,y:e.currentPos.my}))},50)}},onMove:function(a,b){c||(this.currentPos=b,o.onMove(a,{dx:-b.dx*o.width/this.imgWidth,dy:-b.dy*o.height/this.imgHeight}))},onEnd:function(){function e(){f<=60&&(a.sliderMomentumFrame=requestAnimationFrame(e)),g+=k(f,b/3,-b/3,60),h+=k(f,d/3,-d/3,60),o.onMove(null,{dx:-(g*o.width/a.imgWidth),dy:-(h*o.height/a.imgHeight)}),f++}if(!c){var a=this,b=this.positions[1].x-this.positions[0].x,d=this.positions[1].y-this.positions[0].y;if(Math.abs(b)>30||Math.abs(d)>30){var f=1,g=a.currentPos.dx,h=a.currentPos.dy;e()}}}}).init(),q=0;m.on("mousewheel"+e+" DOMMouseScroll"+e,function(c){if(b.zoomOnMouseWheel&&a.loaded){a._clearFrames();var e=Math.max(-1,Math.min(1,c.originalEvent.wheelDelta||-c.originalEvent.detail)),f=a.zoomValue*(100+e*i)/100;if(f>=100&&f<=b.maxZoom?q=0:q+=Math.abs(e),!(q>j)){c.preventDefault();var g=d.offset(),h=(c.pageX||c.originalEvent.pageX)-g.left,k=(c.pageY||c.originalEvent.pageY)-g.top;a.zoom(f,{x:h,y:k}),x()}}}),m.on("touchstart"+e,function(b){if(a.loaded){var e=b.originalEvent.touches[0],f=b.originalEvent.touches[1];if(e&&f){c=!0;var g=d.offset(),i=Math.sqrt(Math.pow(f.pageX-e.pageX,2)+Math.pow(f.pageY-e.pageY,2)),j=a.zoomValue,k={x:(f.pageX+e.pageX)/2-g.left,y:(f.pageY+e.pageY)/2-g.top},l=function(b){b.preventDefault();var c=b.originalEvent.touches[0],d=b.originalEvent.touches[1],e=Math.sqrt(Math.pow(d.pageX-c.pageX,2)+Math.pow(d.pageY-c.pageY,2)),f=j+(e-i)/2;a.zoom(f,k)},m=function(){h.off("touchmove",l),h.off("touchend",m),c=!1};h.on("touchmove",l),h.on("touchend",m)}}});var s,r=0;m.on("click"+e,function(c){0==r?(r=Date.now(),s={x:c.pageX,y:c.pageY}):Date.now()-r<500&&Math.abs(c.pageX-s.x)<50&&Math.abs(c.pageY-s.y)<50?(a.zoomValue==b.zoomValue?a.zoom(200):a.resetZoom(),r=0):r=0});var v,w,t=a.snapView.find(".iv-zoom-slider");new n(t,{sliderId:a._viewerId,onStart:function(b){return!!a.loaded&&(this.leftOffset=t.offset().left,this.handleWidth=a.zoomHandle.width(),void this.onMove(b))},onMove:function(c,d){var e=(c.pageX||c.originalEvent.touches[0].pageX)-this.leftOffset-this.handleWidth/2;e=Math.max(0,e),e=Math.min(a._zoomSliderLength,e);var f=100+(b.maxZoom-100)*e/a._zoomSliderLength;a.zoom(f)}}).init();m.on("touchmove"+e+" mousemove"+e,function(){x()});var y={};y["mouseenter"+e+" touchstart"+e]=function(){w=!1,x(!0)},y["mouseleave"+e+" touchend"+e]=function(){w=!1,x()},a.snapView.on(y),b.refreshOnResize&&g.on("resize"+e,function(){a.refresh()}),a._fullPage&&(d.on("touchmove"+e+" mousewheel"+e+" DOMMouseScroll"+e,function(a){a.preventDefault()}),d.find(".iv-close").on("click"+e,function(){a.hide()}))},zoom:function(a,b){function q(){j++,j<20&&(c._zoomFrame=requestAnimationFrame(q));var g=k(j,e,a-e,20),l=g/e,r=c.imageDim.w*g/100,s=c.imageDim.h*g/100,t=-((b.x-h)*l-b.x),u=-((b.y-i)*l-b.y);t=Math.min(t,m),u=Math.min(u,n),t+r<o&&(t=o-r),u+s<p&&(u=p-s),f.css({height:s+"px",width:r+"px",left:t+"px",top:u+"px"}),c.zoomValue=g,c._resizeHandle(r,s,t,u),c.zoomHandle.css("left",(g-100)*c._zoomSliderLength/(d-100)+"px")}a=Math.round(Math.max(100,a)),a=Math.min(this.options.maxZoom,a),b=b||{x:this.containerDim.w/2,y:this.containerDim.h/2};var c=this,d=this.options.maxZoom,e=this.zoomValue,f=this.currentImg,g=this.containerDim,h=parseFloat(f.css("left")),i=parseFloat(f.css("top"));c._clearFrames();var j=0,g=c.containerDim,l=c.imageDim,m=(g.w-l.w)/2,n=(g.h-l.h)/2,o=g.w-m,p=g.h-n;q()},_clearFrames:function(){clearInterval(this._imageSlider.slideMomentumCheck),cancelAnimationFrame(this._imageSlider.sliderMomentumFrame),cancelAnimationFrame(this._zoomFrame)},resetZoom:function(){this.zoom(this.options.zoomValue)},_calculateDimensions:function(){var a=this,b=a.currentImg,c=a.container,d=a.snapView,e=b.width(),f=b.height(),g=c.width(),h=c.height(),i=d.innerWidth(),j=d.innerHeight();a.containerDim={w:g,h:h};var k,l,m=e/f;k=e>f&&h>=g||m*h>g?g:m*h,l=k/m,a.imageDim={w:k,h:l},b.css({width:k+"px",height:l+"px",left:(g-k)/2+"px",top:(h-l)/2+"px","max-width":"none","max-height":"none"});var n=k>l?i:k*j/l,o=l>k?j:l*i/k;a.snapImageDim={w:n,h:o},a.snapImg.css({width:n,height:o}),a._zoomSliderLength=i-a.zoomHandle.outerWidth()},refresh:function(){this.loaded&&(this._calculateDimensions(),this.resetZoom())},_resizeHandle:function(a,b,c,d){var e=this.currentImg,f=a||this.imageDim.w*this.zoomValue/100,g=b||this.imageDim.h*this.zoomValue/100,h=Math.max(100*-(c||parseFloat(e.css("left")))/f,0),i=Math.max(100*-(d||parseFloat(e.css("top")))/g,0),j=Math.min(100*this.containerDim.w/f,100),k=Math.min(100*this.containerDim.h/g,100);this.snapHandle.css({top:i+"%",left:h+"%",width:j+"%",height:k+"%"})},show:function(a,b){this._fullPage&&(this.container.show(),a&&this.load(a,b))},hide:function(){this._fullPage&&this.container.hide()},options:function(a,b){return b?void(this.options[a]=b):this.options[a]},destroy:function(a,b){var c="."+this._viewerId;return this._fullPage?(container.off(c),container.find('[class^="iv"]').off(c)):this.container.remove('[class^="iv"]'),g.off(c),null},load:function(b,c){function h(){d.loaded=!0,d.zoomValue=100,g.show(),d.snapImg.show(),d.refresh(),d.resetZoom(),c||e.find(".iv-loader").hide()}function i(){e.find(".iv-loader").hide()}var d=this,e=this.container;e.find(".iv-snap-image,.iv-large-image").remove();var f=this.container.find(".iv-snap-image-wrap");f.prepend('<img class="iv-snap-image" src="'+b+'" />'),this.imageWrap.prepend('<img class="iv-large-image" src="'+b+'" />'),c&&this.imageWrap.append('<img class="iv-large-image" src="'+c+'" />');var g=this.currentImg=this.container.find(".iv-large-image");this.snapImg=this.container.find(".iv-snap-image"),d.loaded=!1,e.find(".iv-loader").show(),g.hide(),d.snapImg.hide(),l(g[0])?h():a(g[0]).on("load",h),c&&(l(g[1])?i():a(g[1]).on("load",i))}},o.defaults={zoomValue:100,snapView:!0,maxZoom:500,refreshOnResize:!0,zoomOnMouseWheel:!0},b.ImageViewer=function(b,c){var d,e,f;b&&("string"==typeof b||b instanceof Element||b[0]instanceof Element)||(c=b,b=a("#iv-container")),b=a(b),b.is("img")?(d=b,e=d[0].src,f=d.attr("high-res-src")||d.attr("data-high-res-src"),b=d.wrap('<div class="iv-container" style="display:inline-block; overflow:hidden"></div>').parent(),d.css({opacity:0,position:"relative",zIndex:-1})):(e=b.attr("src")||b.attr("data-src"),f=b.attr("high-res-src")||b.attr("data-high-res-src"));var g=new o(b,c);return g._init(),e&&g.load(e,f),g},a.fn.ImageViewer=function(c){return this.each(function(){var d=a(this),e=b.ImageViewer(d,c);d.data("ImageViewer",e)})}}(window.jQuery,window,document);